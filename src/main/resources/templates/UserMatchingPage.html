<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>운동 매칭 시스템</title>
        <link rel="stylesheet" th:href="@{/bootstrap.min.css}" />
        <!-- Bootstrap CSS 경로 확인 -->
    </head>
    <body>
        <!-- 네비게이션 바는 layout.html에서 포함됨 -->
        <nav th:replace="~{navbar :: navbarFragment}"></nav>

        <!-- 메인 콘텐츠 -->
        <div class="container mt-5">
            <h1 class="mb-4">운동 매칭 시스템</h1>

            <h2>사용자 정보</h2>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <select class="form-control" id="gender">
                        <option value="남">남</option>
                        <option value="여">여</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <input type="number" class="form-control" id="weight" placeholder="스쿼트 (kg, 1rm)" />
                </div>
                <div class="col-md-6 mb-3">
                    <input type="number" class="form-control" id="height" placeholder="키 (cm)" />
                </div>
                <div class="col-md-6 mb-3">
                    <input type="number" class="form-control" id="benchPress" placeholder="벤치프레스 (kg, 1rm)" />
                </div>
                <div class="col-md-6 mb-3">
                    <input type="number" class="form-control" id="weight" placeholder="체중 (kg)" />
                </div>
                <div class="col-md-6 mb-3">
                    <input type="number" class="form-control" id="deadlift" placeholder="데드리프트 (kg, 1rm)" />
                </div>
            </div>

            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="sameGenderOnly" />
                <label for="sameGenderOnly" class="form-check-label">같은 성별만 매칭</label>
            </div>

            <div class="mb-3">
                <button class="btn btn-primary" onclick="handleMatchRequest()">매칭 요청</button>
            </div>

            <div id="matchResults" class="mt-5"></div>
            <div id="matchHistory" class="mt-5"></div>
        </div>

        <!-- Popper.js 및 Bootstrap JS 적용 -->
        <script th:src="@{/popper.min.js}"></script>
        <script th:src="@{/bootstrap.min.js}"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const matchButton = document.getElementById('matchButton');
                const historyButton = document.getElementById('historyButton');
                const userForm = document.getElementById('userForm');
                const matchResults = document.getElementById('matchResults');
                const matchHistory = document.getElementById('matchHistory');
            
                matchButton.addEventListener('click', function() {
                    const formData = new FormData(userForm);
                    const userData = Object.fromEntries(formData.entries());
                    
                    fetch('/matching/find', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        displayMatchResults(data);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        matchResults.innerHTML = '<p>매칭 과정에서 오류가 발생했습니다.</p>';
                    });
                });

                function displayMatchResults(results) {
                    matchResults.innerHTML = '<h3>매칭 결과</h3>';
                    if (results.length === 0) {
                        matchResults.innerHTML += '<p>매칭된 사용자가 없습니다.</p>';
                    } else {
                        const resultList = document.createElement('ul');
                        results.forEach(user => {
                            const listItem = document.createElement('li');
                            listItem.textContent = `${user.name} - 유사도: ${user.similarity.toFixed(4)}, IPF GL 점수: ${user.ipfGLPoints.toFixed(2)}`;
                            resultList.appendChild(listItem);
                        });
                        matchResults.appendChild(resultList);
                    }
                }
        </script>
    </body>
</html>
